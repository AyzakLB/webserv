# webserv.conf - All required directives for your project

# Server 1 - Main website
server {
    # NETWORK DIRECTIVES (mandatory)
    listen 127.0.0.1:8080;
    listen localhost:8081;
    
    # ERROR HANDLING (mandatory)
    error_page 404 /errors/not-found.html;
    error_page 500 502 503 504 /errors/server-error.html;
    error_page 403 /errors/forbidden.html;
    
    # REQUEST LIMITS (mandatory)
    client_max_body_size 10M;
    
    # DEFAULT FILE SERVING (mandatory)
    root /var/www/html;
    index index.html index.htm;
    
    # LOCATIONS (mandatory route configurations)
    
    # Default location - static files
    location / 
        allow_methods GET POST DELETE;
        root /var/www/html;
        index index.html index.htm default.html;
        autoindex off;
    }
    
    # File upload endpoint
    location /upload {
        allow_methods POST;
        upload_path /var/www/uploads;
        client_max_body_size 50M;     # Override global limit
    }
    
    # Public file browsing
    location /files {
        allow_methods GET;
        root /var/www/public;
        autoindex on;                 # Enable directory listing
    }
    
    # API with CGI support
    location /api {
        allow_methods GET POST DELETE;
        root /var/www/api;
        cgi .php /usr/bin/php-cgi;
        cgi .py /usr/bin/python3;
    }
    
    # Redirection example
    location /old-section {
        return 301 /new-section;
    }
    
    # Different document root
    location /docs {
        allow_methods GET;
        root /var/documentation;       # Maps /docs/file -> /var/documentation/file
        index readme.html;
        autoindex on;
    }
}

# Server 2 - Different website/API on different port
server {
    # Different network binding
    listen 127.0.0.1:9000;
    listen 0.0.0.0:9001;
    
    # Different error pages
    error_page 404 /api-404.json;
    error_page 500 /api-error.json;
    
    # Smaller body limit for API
    client_max_body_size 5M;
    
    # API-focused configuration
    root /var/api;
    index api.html;
    
    location / {
        allow_methods GET POST DELETE;
        cgi .php /usr/bin/php-cgi;
        cgi .py /usr/bin/python3;
    }
    
    location /upload {
        allow_methods POST;
        upload_path /var/api/uploads;
        client_max_body_size 100M;
    }
}

# Server 3 - Simple static file server
server {
    listen 127.0.0.1:8082;
    
    error_page 404 /simple-404.html;
    client_max_body_size 1M;
    
    root /var/www/simple;
    index index.html;
    
    location / {
        allow_methods GET;
        autoindex on;
    }
}
